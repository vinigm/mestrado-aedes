import pandas as pd
from pathlib import Path

# Configure o seu diretório base
BASE_DIR = Path(r'C:\Users\Vinicius Mello\OneDrive\Mestrado\Mestrado mesmo\ScriptScrapping')
ARQUIVO_2024 = BASE_DIR / 'Bases de dados' / 'DENGBR24.csv'

print("--- Investigando os municípios do Rio Grande do Sul no arquivo de 2024 ---")
try:
    if ARQUIVO_2024.exists():
        print("Carregando arquivo de 2024 (pode levar um momento)...")
        # Carrega as colunas que precisamos para a investigação
        df24 = pd.read_csv(ARQUIVO_2024, usecols=['SG_UF_NOT', 'ID_MUNICIP'], low_memory=False)

        # 1. Filtra apenas para o Rio Grande do Sul (código 43)
        # Usamos .dropna() para remover qualquer valor nulo que possa atrapalhar a conversão
        df24.dropna(subset=['SG_UF_NOT'], inplace=True)
        df_rs = df24[df24['SG_UF_NOT'].astype(int) == 43].copy()
        
        print(f"Encontradas {len(df_rs)} notificações totais para o Rio Grande do Sul.")

        if len(df_rs) > 0:
            # 2. Lista os códigos de municípios ÚNICOS encontrados para o RS
            # Removemos valores nulos de ID_MUNICIP e convertemos para inteiro por segurança
            df_rs.dropna(subset=['ID_MUNICIP'], inplace=True)
            municipios_no_rs = df_rs['ID_MUNICIP'].astype(int).unique()
            
            print(f"Encontrados {len(municipios_no_rs)} municípios diferentes no RS.")
            print("Amostra dos 10 primeiros códigos de município encontrados:", municipios_no_rs[:10])

            # 3. Verifica ESPECIFICAMENTE se o código de Porto Alegre está na lista
            codigo_poa = 4314902
            if codigo_poa in municipios_no_rs:
                print("\n>>> SUCESSO INEQUÍVOCO: O código de Porto Alegre (4314902) FOI ENCONTRADO na lista de municípios do RS.")
                
                # Se foi encontrado, vamos tentar contar novamente a partir da base já filtrada do RS
                casos_poa = df_rs[df_rs['ID_MUNICIP'].astype(int) == codigo_poa]
                print(f"Total de notificações para o código 4314902 dentro do RS: {len(casos_poa)}")
            else:
                print(f"\n>>> MISTÉRIO PROFUNDO: O código de Porto Alegre (4314902) NÃO FOI ENCONTRADO entre os {len(municipios_no_rs)} municípios do RS neste arquivo.")
        else:
            print("Apesar do código de estado 43 existir, nenhuma linha foi de fato filtrada. Pode haver um problema de tipo de dado (ex: 43.0 vs 43).")

except Exception as e:
    print(f"Ocorreu um erro durante a execução: {e}")